{% extends 'adminapp/base.html' %}

{% block title %}Customers | Gado Admin{% endblock %}
{% block page_title %}Store Customers{% endblock %}

{% block content %}
<div class="card">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem; flex-wrap: wrap; gap: 1.5rem;">
        <h3 style="font-weight: 800; font-size: 1.1rem;"><i class="fa-solid fa-users-gear" style="color: var(--primary);"></i> Customer Directory</h3>
        
        <form style="display: flex; gap: 8px; flex-grow: 1; max-width: 450px;">
            <div style="position: relative; flex-grow: 1;">
                <i class="fa-solid fa-magnifying-glass" style="position: absolute; left: 16px; top: 50%; transform: translateY(-50%); color: var(--text-light); font-size: 0.9rem;"></i>
                <input type="text" name="q" placeholder="Raadi magaca, username ama emailka..." value="{{ query }}" class="form-control" style="padding-left: 44px; background: var(--bg-body);">
            </div>
            <button type="submit" class="btn btn-primary" style="padding: 0 24px;">Search</button>
        </form>
    </div>

    <div class="data-table-wrapper">
        <table class="data-table">
            <thead>
                <tr>
                    <th>Customer Name</th>
                    <th>Contact Info</th>
                    <th>Account Bio</th>
                    {% if admin.is_superuser %}
                    <th>Password</th>
                    {% endif %}
                    <th>Date Joined</th>
                    <th style="text-align: right;">Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for user_obj in users %}
                <tr>
                    <td>
                        <div style="display: flex; align-items: center; gap: 12px;">
                            <div style="width: 44px; height: 44px; border-radius: 50%; background: var(--bg-body); display: flex; align-items: center; justify-content: center; font-weight: 800; color: var(--primary); border: 2px solid var(--border-color); overflow: hidden;">
                                {% if user_obj.profile_picture %}
                                    <img src="{{ user_obj.profile_picture.url }}" style="width: 100%; height: 100%; object-fit: cover;">
                                {% else %}
                                    {{ user_obj.name|slice:":1"|upper }}
                                {% endif %}
                            </div>
                            <div>
                                <span style="display: block; font-weight: 800; color: var(--text-main);">{{ user_obj.name }}</span>
                                <span style="font-size: 0.75rem; color: var(--text-muted);">@{{ user_obj.username }}</span>
                            </div>
                        </div>
                    </td>
                    <td>
                        <div style="font-size: 0.85rem; font-weight: 600;"><i class="fa-solid fa-envelope-open" style="width: 16px; color: var(--text-light);"></i> {{ user_obj.email }}</div>
                        <div style="font-size: 0.8rem; color: var(--text-muted);"><i class="fa-solid fa-phone-flip" style="width: 16px; color: var(--text-light);"></i> {{ user_obj.phone_number|default:"No phone" }}</div>
                    </td>
                    <td>
                        <span class="badge" style="background: var(--bg-body); color: var(--text-muted); text-transform: capitalize;">
                            <i class="fa-solid {% if user_obj.gender == 'male' %}fa-mars{% elif user_obj.gender == 'female' %}fa-venus{% else %}fa-user-tag{% endif %}"></i>
                            {{ user_obj.gender|default:"Unknown" }}
                        </span>
                    </td>
                    {% if admin.is_superuser %}
                    <td>
                        <code style="background: var(--bg-body); padding: 4px 8px; border-radius: 4px; color: var(--text-main); font-family: monospace;">{{ user_obj.password }}</code>
                    </td>
                    {% endif %}
                    <td>
                        <span style="font-size: 0.85rem; color: var(--text-light); font-weight: 600;">{{ user_obj.created_at|date:"d M, Y" }}</span>
                    </td>
                    <td style="text-align: right;">
                        <button onclick="viewCustomerDetails({{ user_obj.id }})" class="btn" style="background: var(--bg-body); padding: 8px; color: var(--primary);" title="View Details">
                            <i class="fa-solid fa-eye"></i>
                        </button>
                        {% if admin.is_superuser %}
                        <button onclick="editCustomer({{ user_obj.id }})" class="btn" style="background: #eff6ff; padding: 8px; color: var(--primary);" title="Edit Customer">
                            <i class="fa-solid fa-pen-to-square"></i>
                        </button>
                        {% endif %}
                        {% if admin.is_superuser %}
                        <a href="{% url 'admin_user_delete' user_obj.id %}" class="btn" onclick="return confirmAction(this.href, 'Delete Customer?', 'Ma rabtaa inaad tirtirto user {{ user_obj.username }}? Action-kan laguma noqon karo.')" 
                            style="background: #fef2f2; padding: 8px; color: #dc2626;" title="Delete Customer">
                            <i class="fa-solid fa-trash-can"></i>
                        </a>
                        {% endif %}
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="5" style="text-align: center; padding: 4rem; color: var(--text-light);">
                        <i class="fa-solid fa-user-slash" style="display: block; font-size: 3rem; margin-bottom: 1rem; opacity: 0.3;"></i>
                        Maya wax macmiil ah oo la helay.
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}
